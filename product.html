<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Detail - Kama ZenNext</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/assets/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root { --primary: #6366f1; --dark: #0f172a; --muted: #64748b; --border: #e2e8f0; --bg: #f8fafc; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--dark); }
    a { color: inherit; text-decoration: none; }
    .site-header { background: #fff; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 10; }
    .nav-container { max-width: 1100px; margin: 0 auto; padding: 16px 20px; display: flex; align-items: center; gap: 16px; }
    .brand { font-weight: 800; font-size: 1.2rem; color: var(--primary); }
    nav { display: flex; gap: 14px; flex: 1; flex-wrap: wrap; }
    nav a { padding: 8px 10px; border-radius: 8px; font-weight: 600; }
    nav a:hover { background: #eef2ff; }
    .cta { background: linear-gradient(135deg, var(--primary), #a855f7); color: #fff; padding: 10px 14px; border-radius: 10px; font-weight: 700; }
    main { max-width: 1100px; margin: 30px auto 80px; padding: 0 20px; }
    .hero { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 24px; box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06); }
    .title-row { display: flex; gap: 16px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .title-row h1 { margin: 0; font-size: 2rem; }
    .badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-size: 0.85rem; font-weight: 700; }
    .badge.cat { background: #eef2ff; color: #312e81; }
    .badge.api { background: #ecfeff; color: #155e75; }
    .badge.price { background: #fef3c7; color: #92400e; }
    .tagline { color: var(--muted); margin: 8px 0 12px; }
    .meta { color: var(--muted); display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-top: 14px; }
    .pill { background: #e2e8f0; color: #0f172a; padding: 8px 12px; border-radius: 999px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; }
    .section { margin-top: 28px; }
    .section h3 { margin-bottom: 12px; }
    ul { padding-left: 18px; margin: 0; color: var(--muted); line-height: 1.6; }
    .compare-btn { border: 1px solid var(--primary); color: var(--primary); background: #eef2ff; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    @media (max-width: 640px) { nav { width: 100%; order: 3; } .nav-container { flex-wrap: wrap; } .cta { width: 100%; text-align: center; } }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="nav-container">
      <a class="brand" href="/">Kama ZenNext</a>
      <nav>
        <a href="/">Home</a>
        <a href="/software.html">Products</a>
        <a href="/compare.html">Compare</a>
        <a href="/ai-assistant.html">AI Assistant</a>
        <a href="/contact.html">Contact</a>
      </nav>
      <a class="cta" href="/sell.html">Submit a tool (Coming soon)</a>
    </div>
  </header>

  <main>
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <ol>
        <li><a href="/">Home</a></li>
        <li><a href="/software.html">Products</a></li>
        <li><a id="productCategoryLink" href="/software.html">Category</a></li>
        <li id="productCrumb" aria-current="page">Product</li>
      </ol>
    </nav>
    <div id="productCard" class="hero" aria-live="polite">Loading...</div>
  </main>

  <script type="module">
    import { injectBaseSchema, injectBreadcrumbs, setMeta } from '/assets/js/seo-schema.js';

    const params = new URLSearchParams(window.location.search);
    const productId = params.get('id');
    const card = document.getElementById('productCard');
    const crumbCategoryLink = document.getElementById('productCategoryLink');
    const crumbProduct = document.getElementById('productCrumb');
    const origin = window.location.origin;

    injectBaseSchema({
      siteName: 'Kama ZenNext',
      siteUrl: origin,
      logoUrl: `${origin}/assets/favicon.svg`
    });

    const getCompareIds = () => {
      try { return JSON.parse(localStorage.getItem('kz_compare_ids')) || []; }
      catch { return []; }
    };
    const saveCompareIds = (ids) => localStorage.setItem('kz_compare_ids', JSON.stringify(ids.slice(0, 4)));
    const addToCompare = (id) => {
      const ids = getCompareIds();
      if (ids.includes(id)) return ids;
      if (ids.length >= 4) { alert('You can only compare up to 4 products.'); return ids; }
      ids.push(id); saveCompareIds(ids); return ids;
    };

    const slugify = (str) => (str || '').toString().toLowerCase().trim().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');

    const buildStructuredData = (product, canonicalUrl) => {
      if (!product) return null;
      const data = {
        '@context': 'https://schema.org',
        '@type': 'SoftwareApplication',
        name: product.name,
        applicationCategory: `${product.category} software`,
        operatingSystem: (product.platforms || []).join(', ') || 'Web',
        url: product.website || canonicalUrl,
        dateModified: product.last_updated || new Date().toISOString().slice(0, 10)
      };
      if (product.pricing) {
        data.offers = {
          '@type': 'Offer',
          price: product.pricing.starting_price !== undefined ? product.pricing.starting_price : '',
          priceCurrency: 'USD',
          category: product.pricing.model
        };
      }
      if (product.rating && Number(product.rating) > 0) {
        data.aggregateRating = {
          '@type': 'AggregateRating',
          ratingValue: product.rating,
          reviewCount: product.review_count || 0
        };
      }
      return data;
    };

    const hydrateSEO = (product) => {
      if (!product) return;
      const canonicalUrl = `${origin}/p/${encodeURIComponent(product.id)}`;
      const title = `${product.name} | ${product.category} AI Tool | Kama ZenNext`;
      const description = (product.tagline || '').substring(0, 150);
      const categoryUrl = `${origin}/category/${slugify(product.category)}`;

      setMeta({
        title,
        description,
        canonicalUrl,
        ogTitle: title,
        ogDescription: description,
        ogUrl: canonicalUrl,
        ogType: 'product'
      });

      injectBreadcrumbs([
        { name: 'Home', url: `${origin}/` },
        { name: 'Products', url: `${origin}/software.html` },
        { name: product.category, url: categoryUrl },
        { name: product.name, url: canonicalUrl }
      ]);

      const ldData = buildStructuredData(product, canonicalUrl);
      if (ldData) {
        const script = document.createElement('script');
        script.type = 'application/ld+json';
        script.textContent = JSON.stringify(ldData);
        document.head.appendChild(script);
      }
    };

    const renderProduct = (product) => {
      if (!product) {
        card.innerHTML = `<p>Product not found. <a href="/software.html">Back to Products</a></p>`;
        crumbCategoryLink.textContent = 'Products';
        crumbCategoryLink.href = '/software.html';
        crumbProduct.textContent = 'Product';
        return;
      }
      hydrateSEO(product);
      const compareIds = getCompareIds();
      const categoryLink = `/category/${slugify(product.category)}`;
      crumbCategoryLink.textContent = product.category;
      crumbCategoryLink.href = categoryLink;
      crumbProduct.textContent = product.name;
      card.innerHTML = `
        <div class="title-row">
          <div>
            <a class="badge cat" href="${categoryLink}"><i class="fa-solid fa-tag"></i> ${product.category}</a>
            <h1>${product.name}</h1>
            <p class="tagline">${product.tagline || ''}</p>
          </div>
          <button class="compare-btn" id="compareBtn">${compareIds.includes(product.id) ? 'In Compare' : 'Add Compare'}</button>
        </div>
        <div class="meta">
          <div><strong>Pricing:</strong> ${product.pricing ? product.pricing.model : 'N/A'} (${product.pricing && product.pricing.starting_price !== undefined ? '$' + product.pricing.starting_price : ''})</div>
          <div><strong>API:</strong> ${product.api ? 'Yes' : 'No'}</div>
          <div><strong>Platforms:</strong> ${product.platforms ? product.platforms.join(', ') : 'N/A'}</div>
          <div><strong>Last updated:</strong> ${product.last_updated}</div>
        </div>
        <div class="section">
          <h3>Best for</h3>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">${(product.best_for || []).map(item => `<span class="pill">${item}</span>`).join('')}</div>
        </div>
        <div class="section">
          <h3>Key features</h3>
          <ul>${(product.key_features || []).map(f => `<li>${f}</li>`).join('')}</ul>
        </div>
        <div class="section">
          <h3>Integrations</h3>
          <p class="tagline">${(product.integrations || []).join(', ')}</p>
        </div>
        <div class="section">
          <a class="cta" href="${product.website}" target="_blank" rel="noopener">Visit website</a>
        </div>
      `;
      document.getElementById('compareBtn').addEventListener('click', () => {
        const ids = addToCompare(product.id);
        if (ids.includes(product.id)) document.getElementById('compareBtn').textContent = 'In Compare';
      });
    };

    if (!productId) {
      renderProduct(null);
    } else {
      fetch('/data/products.json')
        .then(res => res.json())
        .then(list => renderProduct((list || []).find(p => p.id === productId)))
        .catch(() => renderProduct(null));
    }
  </script>
</body>
</html>
