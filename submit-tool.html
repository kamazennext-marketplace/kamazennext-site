<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit a Tool - Kama ZenNext</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
  <style>
    :root { --primary: #6366f1; --dark: #0f172a; --muted: #64748b; --border: #e2e8f0; --bg: #f8fafc; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--dark); }
    a { color: inherit; text-decoration: none; }
    .site-header { background: #fff; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 10; }
    .nav-container { max-width: 960px; margin: 0 auto; padding: 16px 20px; display: flex; align-items: center; gap: 16px; }
    .brand { font-weight: 800; font-size: 1.2rem; color: var(--primary); }
    nav { display: flex; gap: 14px; flex: 1; flex-wrap: wrap; }
    nav a { padding: 8px 10px; border-radius: 8px; font-weight: 600; }
    nav a:hover { background: #eef2ff; }
    .cta { background: linear-gradient(135deg, var(--primary), #a855f7); color: #fff; padding: 10px 14px; border-radius: 10px; font-weight: 700; }
    main { max-width: 960px; margin: 30px auto 80px; padding: 0 20px; }
    .panel { background: #fff; border: 1px solid var(--border); border-radius: 16px; padding: 20px; box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06); }
    h1 { margin-top: 0; }
    form { display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    label { display: flex; flex-direction: column; gap: 6px; font-weight: 600; color: var(--dark); }
    input, select, textarea { padding: 10px; border-radius: 10px; border: 1px solid var(--border); font: inherit; }
    textarea { min-height: 120px; resize: vertical; grid-column: 1 / -1; }
    .actions { display: flex; justify-content: flex-start; }
    button { background: linear-gradient(135deg, var(--primary), #a855f7); color: #fff; border: none; padding: 12px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .alert { border-radius: 10px; padding: 12px; margin-top: 12px; }
    .alert.success { background: #ecfdf3; border: 1px solid #bbf7d0; color: #166534; }
    .alert.error { background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; }
    .helper { color: var(--muted); }
    .hidden-field { position: absolute; left: -9999px; opacity: 0; }
    @media (max-width: 640px) { nav { width: 100%; order: 3; } .nav-container { flex-wrap: wrap; } .cta { width: 100%; text-align: center; } }
  </style>
  <script src="/assets/js/security.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="nav-container">
      <a class="brand" href="/">Kama ZenNext</a>
      <nav>
        <a href="/">Home</a>
        <a href="/software.html">Products</a>
        <a href="/compare.html">Compare</a>
        <a href="/ai-assistant.html">AI Assistant</a>
        <a href="/contact.html">Contact</a>
      </nav>
      <a class="cta" href="/submit-tool.html">Submit a tool (Coming soon)</a>
    </div>
  </header>

  <main>
    <div class="panel">
      <h1>Submit your tool for review</h1>
      <p class="helper">We're curating listings and will reach out once we've reviewed your submission.</p>
      <form id="submitForm" novalidate>
        <label>Name*
          <input type="text" name="name" required aria-required="true">
        </label>
        <label>Email*
          <input type="email" name="email" required aria-required="true">
        </label>
        <label>Tool name*
          <input type="text" name="tool_name" required aria-required="true">
        </label>
        <label>Tool URL*
          <input type="url" name="tool_url" required aria-required="true" placeholder="https://example.com">
        </label>
        <label>Category
          <select name="category" id="categorySelect">
            <option value="">Select a category (optional)</option>
          </select>
        </label>
        <label class="hidden-field">Company
          <input type="text" name="company" tabindex="-1" autocomplete="off">
        </label>
        <label>Message
          <textarea name="message" placeholder="Share context, highlights, and who it's best for."></textarea>
        </label>
        <div class="actions">
          <button type="submit" id="submitBtn">Send submission</button>
        </div>
        <div id="formAlert" role="status" aria-live="polite"></div>
      </form>
    </div>
  </main>

  <script type="module">
    const form = document.getElementById('submitForm');
    const submitBtn = document.getElementById('submitBtn');
    const alertBox = document.getElementById('formAlert');
    const categorySelect = document.getElementById('categorySelect');

    const setAlert = (message, type = 'success') => {
      alertBox.className = `alert ${type}`;
      alertBox.textContent = message;
    };

    const clearAlert = () => {
      alertBox.className = '';
      alertBox.textContent = '';
    };

    const populateCategories = async () => {
      try {
        const res = await fetch('/data/products.json');
        if (!res.ok) return;
        const products = await res.json();
        const categories = Array.from(new Set((products || []).map(p => p.category).filter(Boolean))).sort();
        categories.forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          categorySelect.appendChild(opt);
        });
      } catch (err) {
        console.warn('Could not load categories', err);
      }
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearAlert();
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      const formData = new FormData(form);

      try {
        const response = await fetch('/api/submit-tool.php', {
          method: 'POST',
          body: formData
        });
        const result = await response.json().catch(() => ({ error: 'Unexpected response. Please try again.' }));
        if (response.ok && result.ok) {
          form.reset();
          setAlert('Thanks! Your tool has been submitted to the waitlist.', 'success');
        } else {
          setAlert(result.error || 'Unable to submit right now.', 'error');
        }
      } catch (err) {
        console.error(err);
        setAlert('Network error. Please try again.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send submission';
      }
    });

    populateCategories();
  </script>
</body>
</html>
